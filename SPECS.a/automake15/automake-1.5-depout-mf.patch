--- automake-1.5/m4/depout.m4~	Mon Jan  7 15:36:44 2002
+++ automake-1.5/m4/depout.m4	Mon Jan  7 15:36:44 2002
@@ -11,11 +11,13 @@
 AC_OUTPUT_COMMANDS([
 test x"$AMDEP_TRUE" != x"" ||
 for mf in $CONFIG_FILES; do
-  case "$mf" in
-  Makefile) dirpart=.;;
-  */Makefile) dirpart=`echo "$mf" | sed -e 's|/[^/]*$||'`;;
-  *) continue;;
-  esac
+  # Strip MF so we end up with the name of the file.
+  mf=`echo "$mf" | sed -e 's/:.*$//'`
+  if (head -1 $mf | fgrep 'generated by automake') > /dev/null 2>&1; then
+    dirpart=`dirname "$mf"`
+  else
+    dirpart=
+  fi
   grep '^DEP_FILES *= *[^ #]' < "$mf" > /dev/null || continue
   # Extract the definition of DEP_FILES from the Makefile without
   # running `make'.
