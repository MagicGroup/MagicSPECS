












Summary:	A CHM viewer program for KDE.
Summary(zh_CN.UTF-8):	KDE下的一个CHM查看程序
Name:	kchmviewer
Version:	3.1
Release:	0.git20111215mgc30
License:	GPL
Group:		Applications/File
Group(zh_CN.UTF-8):	应用程序/文件
Url:		http://kchmviewer.soureforge.net/

Source0:	kchmviewer-git20111215.tar.xz



Source1:	kchmviewer_zh_CN.po
Source2:	kchmviewer.desktop
Source3:	make_kchmviewer_git_package.sh
Patch1:		kchmviewer-libtool.patch
Packager:	sejishikong <sejishikong@263.net>
BuildRoot:	/var/tmp/kchmviewer--buildroot

%description
KchmViewer is a chm (MS HTML help file format) viewer, written in C++. Unlike most existing CHM viewers for Unix, it uses Trolltech Qt widget library, and does not depend on KDE or Gnome. However, it may be compiled with full KDE support, including KDE widgets and KIO/KHTML.

%description -l zh_CN.UTF-8
Kchmviewer是一个chm（微软HTML帮助文件格式）查看器，用C++写成。和许多在Unix
下已有的CHM查看器不一样，它使用了Trolltech Qt组件库，不依赖KDE或Gnome，不过，
它可以编译成完全的KDE支持，包括KDE组件和KIO/KHTML。

%prep
rm -rf /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64
%setup -q -n kchmviewer-git20111215
%patch1 -p1

%build
. /etc/profile.d/qt.sh
make -f admin/Makefile.common 
LDFLAGS=$LDFLAGS:-L/usr/lib64/qt-3.3/lib

  CFLAGS="${CFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic}" ; export CFLAGS ; 
  CXXFLAGS="${CXXFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic}" ; export CXXFLAGS ; 
  FFLAGS="${FFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic -I/usr/lib64/gfortran/modules}" ; export FFLAGS ; 
  FCFLAGS="${FCFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic -I/usr/lib64/gfortran/modules}" ; export FCFLAGS ; 
  LDFLAGS="${LDFLAGS:--Wl,-z,relro }"; export LDFLAGS; 
  for i in $(find . -name config.guess -o -name config.sub) ; do 
      [ -f /usr/lib/rpm/magic/$(basename $i) ] && /usr/bin/rm -f $i && /usr/bin/cp -fv /usr/lib/rpm/magic/$(basename $i) $i ; 
  done ; 
  ./configure --build=x86_64-magic-linux-gnu --host=x86_64-magic-linux-gnu \
	--program-prefix= \
	--disable-dependency-tracking \
	--prefix=/usr \
	--exec-prefix=/usr \
	--bindir=/usr/bin \
	--sbindir=/usr/sbin \
	--sysconfdir=/etc \
	--datadir=/usr/share \
	--includedir=/usr/include \
	--libdir=/usr/lib64 \
	--libexecdir=/usr/libexec \
	--localstatedir=/var \
	--sharedstatedir=/var/lib \
	--mandir=/usr/share/man \
	--infodir=/usr/share/info --with-kde --with-qt-dir=/usr/lib64/qt-3.3 --with-qt-libraries=/usr/lib64/qt-3.3/lib
# 临时措施
sed -i 's/\-lqt\-mt/\-L\/usr\/lib\/qt\-3.3\/lib \-lqt\-mt/g' lib/kio-msits/Makefile
make

rm -rf $RPM_BUILD_ROOT

%package debuginfo 
Summary: Debug information for package kchmviewer
Group: Development/Debug
AutoReqProv: 0
%description debuginfo
This package provides debug information for package kchmviewer.
Debug information is useful when developing applications that use this
package or when debugging this package.
%files debuginfo -f debugfiles.list
%defattr(-,root,root)

%install

make install DESTDIR=/home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64
rm -rf /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/locale/
rm -rf /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/applnk
mkdir -p /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/locale/zh_CN/LC_MESSAGES
msgfmt -o /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/locale/zh_CN/LC_MESSAGES/kchmviewer.mo /home/magic/rpmbuild/SOURCES/kchmviewer_zh_CN.po
mkdir -p /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/applications/
cp /home/magic/rpmbuild/SOURCES/kchmviewer.desktop /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/share/applications/
rm -f /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64/usr/lib64/*.a

%clean
rm -rf /home/magic/rpmbuild/BUILDROOT/kchmviewer-3.1-0.git20111215mgc30.x86_64

%files
%defattr(-,root,root)
/usr/bin/kchmviewer
/usr/lib64/trinity/kio_msits.*
/usr/share/applications/kchmviewer.desktop
/usr/share/icons/crystalsvg/*/apps/kchmviewer.png
/usr/share/locale/zh_CN/LC_MESSAGES/kchmviewer.mo
/usr/share/services/msits.protocol

%changelog
--2014-05-13 07:11:54--  http://apt.linuxfans.org/magic/3.0/sources/SOURCES.trinity/kchmviewer/kchmviewer-git20111215.tar.xz
正在解析主机 apt.linuxfans.org (apt.linuxfans.org)... 219.231.240.68
正在连接 apt.linuxfans.org (apt.linuxfans.org)|219.231.240.68|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 404 Not Found
2014-05-13 07:11:54 错误 404：Not Found。

