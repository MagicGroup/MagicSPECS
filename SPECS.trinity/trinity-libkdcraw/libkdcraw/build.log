Name: libkdcraw
Summary: A library for decoding RAW picture files
Summary(zh_CN): 解析 RAW 图片文件的库
Group: Applications/Multimedia
Group(zh_CN): 应用程序/多媒体
Version: 0.1.2
Release: 1mgc30
License: GPLv2+
URL: http://www.kipi-plugins.org/
Source0: http://downloads.sourceforge.net/kipi/libkdcraw-0.1.2.tar.bz2
Patch0:	libkdcraw-0.1.2-admin.patch
BuildRoot: /var/tmp/libkdcraw-0.1.2-1mgc30-root-magic

BuildRequires: kdelibs-devel lcms-devel gettext pkgconfig

%description
libkdcraw is a C++ interface around dcraw binary program used to decode RAW
picture files. The library documentation is available on header files.

This library is used by kipi-plugins, digiKam and others kipi host programs.

%description -l zh_CN
libkdcraw 是一个调用用来解析 RAW 图片文件的 dcraw 二进制程序的 C++ 接口。库文档可以在头文件中找到。

这个库被 kipi-plugins，digiKam 以及其他调用 kipi 的程序所使用。

%package devel
Summary: Development files for libkdcraw
Summary(zh_CN): libkdcraw 的开发文件
Group: Development/Libraries
Group(zh_CN): 开发/库
Requires: libkdcraw = 0.1.2-1mgc30
Requires: pkgconfig

%description devel
This package contains the libraries, include files and other resources
needed to develop applications using libkdcraw.

%description devel
本软件包包含使用 libkdcraw 开发程序所需的开发库，头文件以及其它资源。

%prep
%setup -q
%patch0 -p1
chmod 777 admin/*

%build
unset QTDIR || : ; . /etc/profile.d/qt.sh
make -f admin/Makefile.common

  CFLAGS="${CFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic}" ; export CFLAGS ; 
  CXXFLAGS="${CXXFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic}" ; export CXXFLAGS ; 
  FFLAGS="${FFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic -I/usr/lib64/gfortran/modules}" ; export FFLAGS ; 
  FCFLAGS="${FCFLAGS:--O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic -I/usr/lib64/gfortran/modules}" ; export FCFLAGS ; 
  LDFLAGS="${LDFLAGS:--Wl,-z,relro }"; export LDFLAGS; 
  for i in $(find . -name config.guess -o -name config.sub) ; do 
      [ -f /usr/lib/rpm/magic/$(basename $i) ] && /usr/bin/rm -f $i && /usr/bin/cp -fv /usr/lib/rpm/magic/$(basename $i) $i ; 
  done ; 
  ./configure --build=x86_64-magic-linux-gnu --host=x86_64-magic-linux-gnu \
	--program-prefix= \
	--disable-dependency-tracking \
	--prefix=/usr \
	--exec-prefix=/usr \
	--bindir=/usr/bin \
	--sbindir=/usr/sbin \
	--sysconfdir=/etc \
	--datadir=/usr/share \
	--includedir=/usr/include \
	--libdir=/usr/lib64 \
	--libexecdir=/usr/libexec \
	--localstatedir=/var \
	--sharedstatedir=/var/lib \
	--mandir=/usr/share/man \
	--infodir=/usr/share/info \
	--disable-rpath \
	--disable-debug \
	--disable-dependency-tracking \
	--enable-final \
	--enable-new-ldflags \
	--disable-warnings
#临时措施
sed -i 's/\/include\/tqt/\/include\/tqt \-lm/g' libkdcraw/dcraw/Makefile

/usr/bin/make -j16


%package debuginfo 
Summary: Debug information for package libkdcraw
Group: Development/Debug
AutoReqProv: 0
%description debuginfo
This package provides debug information for package libkdcraw.
Debug information is useful when developing applications that use this
package or when debugging this package.
%files debuginfo -f debugfiles.list
%defattr(-,root,root)

%install

/usr/bin/rm -rf /home/magic/rpmbuild/BUILDROOT/libkdcraw-0.1.2-1mgc30.x86_64
/usr/bin/make DESTDIR=/home/magic/rpmbuild/BUILDROOT/libkdcraw-0.1.2-1mgc30.x86_64 install

/usr/lib/rpm/find-lang.sh /home/magic/rpmbuild/BUILDROOT/libkdcraw-0.1.2-1mgc30.x86_64 libkdcraw

/usr/bin/rm -f /home/magic/rpmbuild/BUILDROOT/libkdcraw-0.1.2-1mgc30.x86_64/usr/lib64/libkdcraw.la

%post
/sbin/ldconfig

touch --no-create /usr/share/icons/hicolor || :
if [ -x /usr/bin/gtk-update-icon-cache ]; then
	/usr/bin/gtk-update-icon-cache --quiet /usr/share/icons/hicolor || :
fi

%postun
/sbin/ldconfig

touch --no-create /usr/share/icons/hicolor || :
if [ -x /usr/bin/gtk-update-icon-cache ]; then
	/usr/bin/gtk-update-icon-cache --quiet /usr/share/icons/hicolor || :
fi

%clean
/usr/bin/rm -rf /home/magic/rpmbuild/BUILDROOT/libkdcraw-0.1.2-1mgc30.x86_64 /home/magic/rpmbuild/BUILD/libkdcraw-0.1.2

%files -f libkdcraw.lang
%defattr(-,root,root,-)
%doc AUTHORS ChangeLog COPYING NEWS README
/usr/lib64/libkdcraw.so.*
/usr/lib64/libkdcraw2/
/usr/share/icons/hicolor/*/apps/kdcraw.png

%files devel
%defattr(-,root,root,-)
/usr/include/libkdcraw/
/usr/lib64/pkgconfig/libkdcraw.pc
/usr/lib64/libkdcraw.so

%changelog
* Tue Oct 2 2007 Ni Hui <shuizhuyuanluo@126.com> - 0.1.2-0.1mgc
- first spec file for MagicLinux-2.1
--2014-05-12 02:05:50--  http://apt.linuxfans.org/magic/3.0/sources/SOURCES.lib/libkdcraw/libkdcraw-0.1.2.tar.bz2
正在解析主机 apt.linuxfans.org (apt.linuxfans.org)... 219.231.240.68
正在连接 apt.linuxfans.org (apt.linuxfans.org)|219.231.240.68|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 404 Not Found
2014-05-12 02:05:50 错误 404：Not Found。

--2014-05-12 02:05:50--  http://downloads.sourceforge.net/kipi/libkdcraw-0.1.2.tar.bz2
正在解析主机 downloads.sourceforge.net (downloads.sourceforge.net)... 216.34.181.59
正在连接 downloads.sourceforge.net (downloads.sourceforge.net)|216.34.181.59|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 302 Object moved
位置：http://61.156.8.189/proxy.html?e=29477ae46e135f86OGQQU7yzsKQa_KuzEyQQLyazFyisLKaX55CAMAuFD7CAILtbFGMAttJo9A4uqAKD4DT93~Kz4Dw8l5uFXECsnftDT7mTeaac4DW9IgAbVXT5M79FcNwinAykpHV53FNDpZmTtXK0oH8sR6yXV~QTvKJbbRiVM9_016 [跟随至新的 URL]
--2014-05-12 02:06:09--  http://61.156.8.189/proxy.html?e=29477ae46e135f86OGQQU7yzsKQa_KuzEyQQLyazFyisLKaX55CAMAuFD7CAILtbFGMAttJo9A4uqAKD4DT93~Kz4Dw8l5uFXECsnftDT7mTeaac4DW9IgAbVXT5M79FcNwinAykpHV53FNDpZmTtXK0oH8sR6yXV~QTvKJbbRiVM9_016
正在连接 61.156.8.189:80... 失败：拒绝连接。
