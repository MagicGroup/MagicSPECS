From 96f766fbf741ebef67d9ef3aa9256f9e94bd24be Mon Sep 17 00:00:00 2001
From: Michal Toman <mtoman@redhat.com>
Date: Fri, 26 Apr 2013 09:20:35 +0200
Subject: [LIBREPORT PATCH 4/6] do not build or install BZ dependencies when
 --without-bugzilla

Signed-off-by: Michal Toman <mtoman@redhat.com>
Signed-off-by: Jiri Moskovcak <jmoskovc@redhat.com>
---
 configure.ac              |  8 ++++----
 doc/Makefile.am           |  2 +-
 src/plugins/Makefile.am   |  9 ++++++---
 src/workflows/Makefile.am | 22 +++++++++++++++++-----
 4 files changed, 28 insertions(+), 13 deletions(-)

diff --git a/configure.ac b/configure.ac
index 179add8..cef8b64 100644
--- a/configure.ac
+++ b/configure.ac
@@ -105,8 +105,8 @@ XMLRPC_CLIENT_LIBS=`xmlrpc-c-config client --libs 2> /dev/null`
 AC_SUBST(XMLRPC_CLIENT_CFLAGS)
 AC_SUBST(XMLRPC_CLIENT_LIBS)
 
-# enable bugzilla translations
-for FILE in `grep "#.*ugzilla.*" po/POTFILES.in`
+# enable bugzilla & deps translations
+for FILE in `grep -e "#.*ugzilla.*" -e "#.*naconda.*" po/POTFILES.in`
 do
   sed -ie "s,$FILE,${FILE:1}," po/POTFILES.in
   sed -ie "\,^${FILE:1}$,d" po/POTFILES.skip
@@ -114,8 +114,8 @@ done
 else
 AM_CONDITIONAL(BUILD_BUGZILLA, false)
 
-# disablie bugzilla translations
-for FILE in `grep "ugzilla" po/POTFILES.in`
+# disablie bugzilla & deps translations
+for FILE in `grep -e "ugzilla" -e "naconda" po/POTFILES.in`
 do
   if test "${FILE:0:1}" = "#"
   then
diff --git a/doc/Makefile.am b/doc/Makefile.am
index fc5241d..b52a043 100644
--- a/doc/Makefile.am
+++ b/doc/Makefile.am
@@ -12,6 +12,7 @@ MAN1_TXT += report-cli.txt
 
 if BUILD_BUGZILLA
 MAN1_TXT += reporter-bugzilla.txt
+MAN1_TXT += report.txt
 endif
 
 MAN1_TXT += reporter-kerneloops.txt
@@ -19,7 +20,6 @@ MAN1_TXT += reporter-mailx.txt
 MAN1_TXT += reporter-print.txt
 MAN1_TXT += reporter-rhtsupport.txt
 MAN1_TXT += reporter-upload.txt
-MAN1_TXT += report.txt
 
 MAN5_TXT =
 MAN5_TXT += report_event.conf.txt
diff --git a/src/plugins/Makefile.am b/src/plugins/Makefile.am
index 16ff97c..129b436 100644
--- a/src/plugins/Makefile.am
+++ b/src/plugins/Makefile.am
@@ -2,7 +2,9 @@ pluginslibdir = $(PLUGINS_LIB_DIR)
 
 reporters_bin =
 if BUILD_BUGZILLA
-reporters_bin += reporter-bugzilla
+reporters_bin += \
+    reporter-bugzilla \
+    report
 endif
 
 if BUILD_UREPORT
@@ -14,8 +16,7 @@ bin_PROGRAMS = $(reporters_bin) \
     reporter-kerneloops \
     reporter-upload \
     reporter-mailx \
-    reporter-print \
-    report
+    reporter-print
 
 pluginsconfdir = $(PLUGINS_CONF_DIR)
 
@@ -218,6 +219,7 @@ reporter_print_CPPFLAGS = \
 reporter_print_LDADD = \
     ../lib/libreport.la
 
+if BUILD_BUGZILLA
 report_SOURCES = \
     report.c
 report_CPPFLAGS = \
@@ -235,6 +237,7 @@ report_CPPFLAGS = \
     -D_GNU_SOURCE
 report_LDADD = \
     ../lib/libreport.la
+endif
 
 if BUILD_UREPORT
 reporter_ureport_SOURCES = \
diff --git a/src/workflows/Makefile.am b/src/workflows/Makefile.am
index 17e3f1a..45ba7e0 100644
--- a/src/workflows/Makefile.am
+++ b/src/workflows/Makefile.am
@@ -3,30 +3,42 @@ workflowsdir = $(WORKFLOWS_DIR)
 dist_workflows_DATA = \
     workflow_Fedora.xml \
     workflow_Upload.xml \
-    workflow_AnacondaFedora.xml \
-    workflow_AnacondaUpload.xml \
     workflow_RHELCCpp.xml \
     workflow_RHELKerneloops.xml \
     workflow_RHELPython.xml \
     workflow_RHELvmcore.xml \
     workflow_RHELxorg.xml
 
+if BUILD_BUGZILLA
+dist_workflows_DATA += \
+    workflow_AnacondaFedora.xml \
+    workflow_AnacondaUpload.xml
+endif
+
 workflowsconfdir = $(WORKFLOWS_CONF_DIR)
 
 dist_workflowsconf_DATA =\
     report_fedora.conf \
-    anaconda_event.conf \
     report_rhel.conf
 
+if BUILD_BUGZILLA
+dist_workflowsconf_DATA += \
+    anaconda_event.conf
+endif
+
 @INTLTOOL_XML_RULE@
 
 EXTRA_DIST = \
     workflow_Fedora.xml.in \
     workflow_Upload.xml.in \
-    workflow_AnacondaFedora.xml.in \
-    workflow_AnacondaUpload.xml.in \
     workflow_RHELCCpp.xml.in \
     workflow_RHELKerneloops.xml.in \
     workflow_RHELPython.xml.in \
     workflow_RHELvmcore.xml.in \
     workflow_RHELxorg.xml.in
+
+if BUILD_BUGZILLA
+EXTRA_DIST += \
+    workflow_AnacondaFedora.xml.in \
+    workflow_AnacondaUpload.xml.in
+endif
-- 
1.8.1.4

