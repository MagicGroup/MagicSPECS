--- include/u.h.orig	2014-02-20 13:51:53.456000000 -0600
+++ include/u.h	2014-02-20 13:55:51.072000000 -0600
@@ -38,9 +38,12 @@
 #		define __MAKECONTEXT_V2_SOURCE 1
 #	endif
 #endif
+#if defined __linux__ || defined __GNU__ || defined __GLIBC__
+#define _DEFAULT_SOURCE 1
+#else
 #define _BSD_SOURCE 1
-#define _NETBSD_SOURCE 1	/* NetBSD */
 #define _SVID_SOURCE 1
+#endif
 #if !defined(__APPLE__) && !defined(__OpenBSD__)
 #	define _XOPEN_SOURCE 1000
 #	define _XOPEN_SOURCE_EXTENDED 1
--- src/lib9/utf/utfecpy.c.orig	2014-02-20 14:12:27.735000000 -0600
+++ src/lib9/utf/utfecpy.c	2014-02-20 14:13:09.242000000 -0600
@@ -11,7 +11,11 @@
  * REPRESENTATION OR WARRANTY OF ANY KIND CONCERNING THE MERCHANTABILITY
  * OF THIS SOFTWARE OR ITS FITNESS FOR ANY PARTICULAR PURPOSE.
  */
-#define _BSD_SOURCE 1
+#if defined __linux__ || defined __GNU__ || defined __GLIBC__
+#define _DEFAULT_SOURCE 1
+#else
+ #define _BSD_SOURCE 1
+#endif
 #include <string.h>
 #include "utf.h"
 #include "utfdef.h"
