diff -urN rpm-4.11.2.orig/fileattrs/kmod.attr rpm-4.11.2/fileattrs/kmod.attr
--- rpm-4.11.2.orig/fileattrs/kmod.attr	1970-01-01 00:00:00.000000000 +0000
+++ rpm-4.11.2/fileattrs/kmod.attr	2014-02-25 09:19:16.632271316 +0000
@@ -0,0 +1,2 @@
+%__kmod_provides       %{_rpmconfigdir}/kmod.prov
+%__kmod_path           ^/lib/modules/.*$
diff -urN rpm-4.11.2.orig/fileattrs/Makefile.am rpm-4.11.2/fileattrs/Makefile.am
--- rpm-4.11.2.orig/fileattrs/Makefile.am	2014-02-25 09:16:55.532274932 +0000
+++ rpm-4.11.2/fileattrs/Makefile.am	2014-02-25 09:19:44.426270603 +0000
@@ -7,6 +7,6 @@
 fattrs_DATA = \
 	appdata.attr desktop.attr elf.attr font.attr libtool.attr perl.attr \
 	perllib.attr pkgconfig.attr python.attr ocaml.attr script.attr \
-	mono.attr
+	mono.attr kmod.attr
 
 EXTRA_DIST = $(fattrs_DATA)
diff -urN rpm-4.11.2.orig/scripts/kmod.prov rpm-4.11.2/scripts/kmod.prov
--- rpm-4.11.2.orig/scripts/kmod.prov	1970-01-01 00:00:00.000000000 +0000
+++ rpm-4.11.2/scripts/kmod.prov	2014-02-25 09:19:16.633271316 +0000
@@ -0,0 +1,17 @@
+#!/bin/sh +x
+
+IFS=$'\n'
+
+for i in $(grep -E '(/lib/modules/.*\.ko|/lib/modules/.*/modules.builtin)');
+do
+	kmod=$(basename $i);
+
+	if [ $kmod == "modules.builtin" ]; then
+		for j in $(cat $i); do
+			j=$(basename $j);
+			echo "kmod($j)"
+		done
+	else
+		echo "kmod($kmod)"
+	fi
+done
diff -urN rpm-4.11.2.orig/scripts/Makefile.am rpm-4.11.2/scripts/Makefile.am
--- rpm-4.11.2.orig/scripts/Makefile.am	2014-02-25 09:16:55.611274930 +0000
+++ rpm-4.11.2/scripts/Makefile.am	2014-02-25 09:19:16.633271316 +0000
@@ -20,7 +20,7 @@
 	ocaml-find-requires.sh ocaml-find-provides.sh \
 	pkgconfigdeps.sh libtooldeps.sh appdata.prov \
 	fontconfig.prov desktop-file.prov script.req \
-	macros.perl macros.php macros.python
+	macros.perl macros.php macros.python kmod.prov
 
 rpmconfig_SCRIPTS = \
 	brp-compress brp-python-bytecompile brp-java-gcjcompile \
@@ -34,7 +34,7 @@
 	pkgconfigdeps.sh libtooldeps.sh \
 	ocaml-find-requires.sh ocaml-find-provides.sh \
 	fontconfig.prov desktop-file.prov script.req \
-	rpmdb_loadcvt rpm2cpio.sh tcl.req tgpg 
+	rpmdb_loadcvt rpm2cpio.sh tcl.req tgpg kmod.prov
 
 rpmconfig_DATA = \
 	rpm.daily rpm.log rpm.supp \
