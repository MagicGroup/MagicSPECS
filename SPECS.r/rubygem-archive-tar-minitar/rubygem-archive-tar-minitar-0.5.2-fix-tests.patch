--- tests/tc_tar.rb.orig	2009-10-26 22:34:53.054062448 -0700
+++ tests/tc_tar.rb	2009-10-26 22:36:49.222080730 -0700
@@ -463,20 +463,22 @@
   include TarTester
 
   require 'rbconfig'
+  require 'time'
 
-  TEST_TGZ = "\037\213\010\000\001B1A\000\vKI,I\324+I,\322K\257b\240\0250\000\002sSS\254\342 `dj\306``nnnbndbjd\000\0247336`P0\240\231\213\220@i1\320\367@+\351a\327 \004\362\335\034\f\313\034\r\035\031\270\337Ns\344b2\344q\335\375M\304\266QM1W\357\321>\221U\021\005\246\306\367\356\367u3\262;\212\004\265\236\\\334}\351,\377\037;\217\223\301e\247\030\024\\\236\211\277\347\346sii\265\010\330\355\234\240\362\274\371[\202\361\366\302S\316\335o&~m\237r\355\377\303\230\365\352WNW\334\266_\373\273\237\347Q\315t?\263{\377?\006\271\337?\367\207\325\346]\371\376y\307_\234~d\3772\265\346\261}\323\317\373\315\352\377O\376\271/\305\377?X\253\324\303S\373\361\347\277\372^)\267\377\363\03460\331\311\\wW|\031\203\300@\207\325p\004i\2319\251\3064\266\203P\376702B\313\377\246\246\006&\243\371\237\036 $#\263X\001\210@\351@\301XO\201\227k\240]4\nF\301(\030\005\243\200\036\000\000\004\330t\023\000\f\000\000"
-  FILETIMES = Time.mktime(2004).to_i
+  # generated with tar 1.22 via tar --format=ustar -czvf
+  TEST_TGZ = "\037\213\b\000u\000\344J\000\003KI,I\324+I,\322K\257b\240\0250\000\002sSS\020mhnj\200L\203\201\261\2419\203\201\271\271\271\211\271\221\211\251\021P\334\320\330\304\324\214A\301\200f.B\002\245\305@\337\003\235\222\233\235\232W\202G\035!y\250_\340\364\020\001\362\335\034\f\321\fO\274\030\230\337^\273\317\325d r\374c\354w\221\352\246\242\342b\375K\177\005L&\375\213\231\261\267~\366\224\220\200D\003\345?u\002}\v6<\356\263\217\b-{\352\265d*\353\271[\021S7\337\254\335+8\263\370\234E\356\032\276\357^\317\255\304/\251\275[]nW\232*\035e\371\346U\362\367g{\375\317\267\363\357\274f\037x\364g\376\254\332\265\227\326\n~_l\360\354\353\237\257\237\377\034\376\301\255\250~\363\310\314\363\365{s\375\214b>\212O\310\332\371\243\324~\306\265\t\365s\363z\327\177z\177\342\277\210\334\247\365'\377\337\371\362\363\373\276\254\250\367\301s\231\217\317\377\377\351P\344\271z\204\037\f\216\261\n\356\316\351c\320\030\270`\034\262 -3'\325\230\306v\020\312\377\006FFh\371\337\310\330\330d4\377\323\003\204dd\026+\000\021(\035(\030\353)\360r\r\264\213F\301(\030\005\243`\024\214\202Q0\nF\301(\030\005\243`\024\214\202Q0\nF\301(\030\005\243`\024\214\202Q0\nF\301(\030\005\243`\024\214\202Q0\nF\001)\000\000\277\313\321J\000(\000\000"
+  FILETIMES = Time.parse('Thu Jan 01 00:00:00 EST 2004').to_i
 
   TEST_CONTENTS = [
-    [ "data.tar.gz", 174, 0755 ],
+    [ "data.tar.gz", 207, 0755 ],
     [ "file3",        18, 0755 ],
   ]
 
   TEST_DATA_CONTENTS = [
-    [ "data",          0, 040755 ],
-    [ "data/file1",   16, 010644 ],
-    [ "data/file2",   16, 010644 ],
-    [ "data/__dir__",  0, 010644 ],
+    [ "data/",         0, 0755,  040755 ], # both tar and unix permissions
+    [ "data/file1",   16, 0644, 0100644 ],
+    [ "data/file2",   16, 0644, 0100644 ],
+    [ "data/__dir__/", 0, 0755,  040755 ],
   ]
 
   def setup
@@ -550,7 +552,7 @@
                 assert(File.file?(name2))
                 assert_equal(TEST_DATA_CONTENTS[jj][1], File.stat(name2).size, name2)
               end
-              assert_equal(TEST_DATA_CONTENTS[jj][2], File.stat(name2).mode, name2) unless RUBY_PLATFORM =~ /win32/
+              assert_equal(TEST_DATA_CONTENTS[jj][3], File.stat(name2).mode, name2) unless RUBY_PLATFORM =~ /win32/
             end
           end
         ensure
