From ea3c4e827367448f3303fb9be0d33105cea1aead Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 5 Apr 2013 09:01:48 +0200
Subject: [PATCH] Add missing options to manpage and --help output

https://bugzilla.redhat.com/show_bug.cgi?id=948510
---
 dracut.8.asc | 30 +++++++++++++++++++++++++-----
 dracut.sh    | 26 ++++++++++++++++----------
 2 files changed, 41 insertions(+), 15 deletions(-)

diff --git a/dracut.8.asc b/dracut.8.asc
index 6a79d12..8b50782 100644
--- a/dracut.8.asc
+++ b/dracut.8.asc
@@ -75,12 +75,12 @@ version is:
 ----
 
 If you want to create lighter, smaller initramfs images, you may want to specify
-the --host-only or -H option. Using this option, the resulting image will
+the --hostonly or -H option. Using this option, the resulting image will
 contain only those dracut modules, kernel modules and filesystems, which are
 needed to boot this specific machine. This has the drawback, that you can't put
 the disk on another controller or machine, and that you can't switch to another
 root filesystem, without recreating the initramfs image. The usage of the
---host-only option is only for experts and you will have to keep the broken
+--hostonly option is only for experts and you will have to keep the broken
 pieces. At least keep a copy of a general purpose image (and corresponding
 kernel) as a fallback to rescue your system.
 
@@ -376,7 +376,7 @@ will not be able to boot. Equivalent to "--compress=bzip2"
 [WARNING]
 ====
 Make sure your kernel has lzma decompression support compiled in, otherwise you
-will not be able to boot. Equivalent to "--compress=lzma -9"
+will not be able to boot. Equivalent to "lzma --compress=lzma -9"
 ====
 
 **--xz**::
@@ -385,8 +385,7 @@ will not be able to boot. Equivalent to "--compress=lzma -9"
 [WARNING]
 ====
 Make sure your kernel has xz decompression support compiled in, otherwise you
-will not be able to boot. Equivalent to "--compress=xz --check=crc32
---lzma2=dict=1MiB"
+will not be able to boot. Equivalent to "lzma --compress=xz --check=crc32 --lzma2=dict=1MiB"
 ====
 
 **--compress** _<compressor>_::
@@ -409,6 +408,27 @@ will not be able to boot. Equivalent to "--compress=xz --check=crc32
 **--keep**::
     Keep the initramfs temporary directory for debugging purposes.
 
+**--printsize**::
+    Print out the module install size
+
+**--profile**:
+    Output profile information of the build process
+
+**--ro-mnt**:
+    Mount / and /usr read-only by default.
+
+**-L, --stdlog** _<level>_::
+    [0-6] Specify logging level (to standard error)
+----
+          0 - suppress any messages
+          1 - only fatal errors
+          2 - all errors
+          3 - warnings
+          4 - info
+          5 - debug info (here starts lots of output)
+          6 - trace info (and even more)
+----
+
 **--regenerate-all**::
     Regenerate all initramfs images at the default location with the kernel versions found on the system.
     Additional parameters are passed through.
diff --git a/dracut.sh b/dracut.sh
index 5e9ea3e..586172c 100755
--- a/dracut.sh
+++ b/dracut.sh
@@ -74,19 +74,21 @@ Creates initial ramdisk images for preloading modules
                          call when building the initramfs. Modules are located
                          in /usr/lib/dracut/modules.d.
   -o, --omit [LIST]     Omit a space-separated list of dracut modules.
+  --force-add [LIST]    Force to add a space-separated list of dracut modules
+                         to the default set of modules, when -H is specified.
   -d, --drivers [LIST]  Specify a space-separated list of kernel modules to
-                        exclusively include in the initramfs.
-  --add-drivers [LIST] Specify a space-separated list of kernel
-                        modules to add to the initramfs.
+                         exclusively include in the initramfs.
+  --add-drivers [LIST]  Specify a space-separated list of kernel
+                         modules to add to the initramfs.
   --omit-drivers [LIST] Specify a space-separated list of kernel
-                        modules not to add to the initramfs.
+                         modules not to add to the initramfs.
   --filesystems [LIST]  Specify a space-separated list of kernel filesystem
-                        modules to exclusively include in the generic
-                        initramfs.
+                         modules to exclusively include in the generic
+                         initramfs.
   -k, --kmoddir [DIR]   Specify the directory, where to look for kernel
-                        modules
+                         modules
   --fwdir [DIR]         Specify additional directories, where to look for
-                        firmwares, separated by :
+                         firmwares, separated by :
   --kernel-only         Only install kernel drivers and firmware files
   --no-kernel           Do not install kernel drivers and firmware files
   --kernel-cmdline [PARAMETERS] Specify default kernel command line parameters
@@ -317,7 +319,9 @@ TEMP=$(unset POSIXLY_CORRECT; getopt \
     --long quiet \
     --long local \
     --long hostonly \
+    --long host-only \
     --long no-hostonly \
+    --long no-host-only \
     --long fstab \
     --long help \
     --long bzip2 \
@@ -391,8 +395,10 @@ while :; do
                        [[ -f "$(readlink -f ${0%/*})/dracut-functions.sh" ]] \
                            && dracutbasedir="$(readlink -f ${0%/*})"
                        ;;
-        -H|--hostonly) hostonly_l="yes" ;;
-        -N|--no-hostonly) hostonly_l="no" ;;
+        -H|--hostonly|--host-only)
+                       hostonly_l="yes" ;;
+        -N|--no-hostonly|--no-host-only)
+                       hostonly_l="no" ;;
         --fstab)       use_fstab_l="yes" ;;
         -h|--help)     long_usage; exit 1 ;;
         -i|--include)  push include_src "$2"
