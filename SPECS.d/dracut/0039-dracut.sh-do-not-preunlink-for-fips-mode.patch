From 8461734ee47fb1078e543f55f9ca6f8530855361 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 25 Apr 2013 21:16:03 +0200
Subject: [PATCH] dracut.sh: do not preunlink for fips mode

just install prelink and the cache files
---
 dracut.sh | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/dracut.sh b/dracut.sh
index 82b4a5f..5f0a1b3 100755
--- a/dracut.sh
+++ b/dracut.sh
@@ -1140,12 +1140,8 @@ fi
 PRELINK_BIN=$(command -v prelink)
 if [[ $UID = 0 ]] && [[ $PRELINK_BIN ]]; then
     if [[ $DRACUT_FIPS_MODE ]]; then
-        dinfo "*** Pre-unlinking files ***"
+        dinfo "*** Installing prelink files ***"
         dracut_install -o prelink /etc/prelink.conf /etc/prelink.conf.d/*.conf /etc/prelink.cache
-        chroot "$initdir" $PRELINK_BIN -u -a
-        rm -f "$initdir"/$PRELINK_BIN
-        rm -fr "$initdir"/etc/prelink.*
-        dinfo "*** Pre-unlinking files done ***"
     else
         dinfo "*** Pre-linking files ***"
         dracut_install -o prelink /etc/prelink.conf /etc/prelink.conf.d/*.conf
