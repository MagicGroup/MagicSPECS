From 9b49e1917d623f7058a135bbfe1facbe1f700540 Mon Sep 17 00:00:00 2001
From: Scott Tsai <scottt.tw@gmail.com>
Date: Sat, 17 Dec 2011 09:35:18 +0800
Subject: [PATCH] Makfile: use menhir-ocamldep instead off ocamldep.wrapper

---
 demos/Makefile.shared      |    2 +-
 demos/OMakefile.shared     |    2 +-
 demos/calc-param/Makefile  |    1 -
 demos/calc-param/OMakefile |    6 +++---
 demos/calc-two/Makefile    |    1 -
 demos/calc-two/OMakefile   |    5 ++---
 demos/calc/Makefile        |    1 -
 demos/calc/OMakefile       |    1 -
 8 files changed, 7 insertions(+), 12 deletions(-)

diff --git a/demos/Makefile.shared b/demos/Makefile.shared
index 93add01..29e2207 100644
--- a/demos/Makefile.shared
+++ b/demos/Makefile.shared
@@ -119,7 +119,7 @@ ifndef OCAMLDEP
 endif
 
 ifndef OCAMLDEPWRAPPER
-  OCAMLDEPWRAPPER:= ./ocamldep.wrapper
+  OCAMLDEPWRAPPER:= $(shell which menhir-ocamldep)
 endif
 
 ifndef OCAMLLEX
diff --git a/demos/OMakefile.shared b/demos/OMakefile.shared
index af8e0ca..4ff1157 100644
--- a/demos/OMakefile.shared
+++ b/demos/OMakefile.shared
@@ -139,7 +139,7 @@ if $(not $(defined OCAMLDEP))
     export
 
 if $(not $(defined OCAMLDEPWRAPPER))
-    OCAMLDEPWRAPPER  = ./ocamldep.wrapper
+    OCAMLDEPWRAPPER  = $(shell which menhir-ocamldep)
     export
 
 if $(not $(defined OCAMLLEX))
diff --git a/demos/calc-param/Makefile b/demos/calc-param/Makefile
index 35d91ef..2f10b9a 100644
--- a/demos/calc-param/Makefile
+++ b/demos/calc-param/Makefile
@@ -3,7 +3,6 @@ PGFLAGS         := --infer
 GENERATED       := parser.ml parser.mli lexer.ml tokens.ml tokens.mli
 MODULES         := parser lexer calc
 EXECUTABLE      := calc
-OCAMLDEPWRAPPER := ../ocamldep.wrapper
 include ../Makefile.shared
 $(eval $(call menhir_monomodule,tokens,--only-tokens))
 $(eval $(call menhir_multimodule,parser,tokens.mly parser.mly,--external-tokens Tokens))
diff --git a/demos/calc-param/OMakefile b/demos/calc-param/OMakefile
index 3a54e55..9241e7a 100644
--- a/demos/calc-param/OMakefile
+++ b/demos/calc-param/OMakefile
@@ -1,7 +1,7 @@
-GENERATED       = parser.ml parser.mli lexer.ml
+GENERATED       = parser.ml parser.mli lexer.ml tokens.ml tokens.mli
 MODULES         = parser lexer calc
 EXECUTABLE      = calc
-OCAMLDEPWRAPPER = ../ocamldep.wrapper
 include ../OMakefile.shared
-MenhirAuto()
+MenhirMono(tokens,--only-tokens)
+MenhirMulti(parser,tokens.mly parser.mly,--external-tokens Tokens)
 .DEFAULT: $(EXECUTABLE)$(OSUFFIX)
diff --git a/demos/calc-two/Makefile b/demos/calc-two/Makefile
index 29a6d52..c5dbc39 100644
--- a/demos/calc-two/Makefile
+++ b/demos/calc-two/Makefile
@@ -3,7 +3,6 @@ PGFLAGS         := --infer
 GENERATED       := tokens.ml tokens.mli algebraic.ml algebraic.mli reverse.ml reverse.mli lexer.ml
 MODULES         := algebraic reverse lexer calc
 EXECUTABLE      := calc
-OCAMLDEPWRAPPER := ../ocamldep.wrapper
 include ../Makefile.shared
 $(eval $(call menhir_monomodule,tokens,--only-tokens))
 $(eval $(call menhir_multimodule,algebraic,tokens.mly algebraic.mly common.mly,--external-tokens Tokens))
diff --git a/demos/calc-two/OMakefile b/demos/calc-two/OMakefile
index 0cb1482..b725fa6 100644
--- a/demos/calc-two/OMakefile
+++ b/demos/calc-two/OMakefile
@@ -1,9 +1,8 @@
 GENERATED       = tokens.ml tokens.mli algebraic.ml algebraic.mli reverse.ml reverse.mli lexer.ml
 MODULES         = algebraic reverse lexer calc
 EXECUTABLE      = calc
-OCAMLDEPWRAPPER = ../ocamldep.wrapper
 include ../OMakefile.shared
 MenhirMono(tokens,--only-tokens)
-MenhirMulti(algebraic,tokens.mly algebraic.mly,--external-tokens Tokens)
-MenhirMulti(reverse,tokens.mly reverse.mly,--external-tokens Tokens)
+MenhirMulti(algebraic,tokens.mly algebraic.mly common.mly,--external-tokens Tokens)
+MenhirMulti(reverse,tokens.mly reverse.mly common.mly,--external-tokens Tokens)
 .DEFAULT: $(EXECUTABLE)$(OSUFFIX)
diff --git a/demos/calc/Makefile b/demos/calc/Makefile
index f411226..f80582d 100644
--- a/demos/calc/Makefile
+++ b/demos/calc/Makefile
@@ -3,6 +3,5 @@ PGFLAGS         := --infer
 GENERATED       := parser.ml parser.mli lexer.ml
 MODULES         := parser lexer calc
 EXECUTABLE      := calc
-OCAMLDEPWRAPPER := ../ocamldep.wrapper
 include ../Makefile.shared
 include ../Makefile.auto
diff --git a/demos/calc/OMakefile b/demos/calc/OMakefile
index 3a54e55..00e1a5c 100644
--- a/demos/calc/OMakefile
+++ b/demos/calc/OMakefile
@@ -1,7 +1,6 @@
 GENERATED       = parser.ml parser.mli lexer.ml
 MODULES         = parser lexer calc
 EXECUTABLE      = calc
-OCAMLDEPWRAPPER = ../ocamldep.wrapper
 include ../OMakefile.shared
 MenhirAuto()
 .DEFAULT: $(EXECUTABLE)$(OSUFFIX)
-- 
1.7.7.4

